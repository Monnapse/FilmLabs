generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Account {
  userId        Int                   @id @default(autoincrement())
  username      String                @unique @db.VarChar(45)
  password      String                @db.VarChar(255)
  watchHistory  AccountWatchHistory[]
  favorites     AccountFavorites[]
}

model Film {
  tmdbId       Int                   @id
  mediaType    String                @db.VarChar(8)
  name         String                @db.VarChar(100)
  releaseDate  String                @db.VarChar(15)
  rating       Float
  poster       String                @db.VarChar(120)
  watchHistory AccountWatchHistory[]
  favorites    AccountFavorites[]
}

model AccountWatchHistory {
  accountHistoryId Int               @id @default(autoincrement())
  tmdbId           Int
  userId           Int
  film             Film              @relation(fields: [tmdbId], references: [tmdbId], onDelete: Cascade)
  account          Account           @relation(fields: [userId], references: [userId], onDelete: Cascade)
  movieHistory     MovieHistory?
  episodeHistory   EpisodeHistory[]
}

model AccountFavorites {
  tmdbId       Int
  userId       Int
  film         Film    @relation(fields: [tmdbId], references: [tmdbId], onDelete: Cascade)
  account      Account @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@id([tmdbId, userId])
}

model MovieHistory {
  accountHistoryId Int                 @id
  progress         String?             @db.VarChar(10)
  watchHistory     AccountWatchHistory @relation(fields: [accountHistoryId], references: [accountHistoryId], onDelete: Cascade)
}

model EpisodeHistory {
  accountHistoryId Int
  seasonNumber     Int
  episodeNumber    Int
  progress         String?             @db.VarChar(10)
  watchHistory     AccountWatchHistory @relation(fields: [accountHistoryId], references: [accountHistoryId], onDelete: Cascade)

  @@id([accountHistoryId, seasonNumber, episodeNumber])
}